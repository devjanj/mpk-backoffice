generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Invoice {
  id             String   @id @default(cuid())
  source         String   // "BANK" or "CF"
  
  // Scraped Data
  date           DateTime @default(now())
  projectNumber  String
  description    String
  amount         Float
  type           String   // "INCOME" or "OUTCOME"
  taxAmount      Float?
  
  // File details
  driveFileId    String?
  driveFileLink  String?
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model TransactionSplit {
  id              String   @id @default(cuid())
  transactionHash String   // A unique fingerprint combining date+amount+balance to map database allocation to an immutable Excel row
  projectNumber   String   // The project this split is allocated to
  amount          Float    // The monetary value of this split
  note            String?  // Optional explanation for this split

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([transactionHash]) // Optimizes lookups since we will scan this hash for every row parsed from Excel
}

model ProjectStatus {
  projectNumber   String   @id
  status          String   @default("ACTIVE") // ACTIVE, FINISHED
  updatedAt       DateTime @updatedAt
}
